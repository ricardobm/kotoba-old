# Attribution and License

Contains data from:

- http://www.edrdg.org/edrdg/licence.html
  - Compiled from https://foosoft.net/projects/yomichan/
- https://kanjivg.tagaini.net/
- http://hochanh.github.io/rtk/

# Importing data

This directory is for Yomichan compatible zip files. For details on the files
see https://foosoft.net/projects/yomichan/.

Running `make import-data` in the main project will import all files in this
directory and generate the intermediate output files used by the dictionary.

# Output format

## String files

All files in this contain one entry per line and are referenced using one-based
indexes, where zero denotes an empty string. The purpose of these files is to
de-duplicate string data.

- __`terms.txt`__ - each line contains a Japanese term expression or reading as it
  originally appears in the dictionary. Referenced by _`dictionary_main.txt`_.
  This is sorted lexicographically.
- __`glossary.txt`__ - each line contains an english glossary definition. This is
  referenced by the term definitions (`text` field) in _`dictionary_data.txt`_.
  This is sorted lexicographically.
- __`search.txt`__ - each line contains the processed search key for a term. The
  search key is an ASCII `a-z` only derived from the romaji reading for a term.
  This is referenced by _`dictionary_main.txt`_. This is sorted lexicographically.
- __`sources.txt`__ - each line contains the name of a dictionary data source.
  This is referenced by the `source` field in _`dictionary_data.txt`_. This is
  sorted lexicographically.

## Dictionary files

- __`dictionary_main.txt`__ - contains the main index for the dictionary. Each
line is a tuple `expression,reading,search_key,frequency` (indexes are one based):
  - `expression` is the main Japanese term, indexing entries in _`terms.txt`_.
  - `reading` is the Japanese reading for the term, usually in Hiragana, this
    indexes entries in _`terms.txt`_.
  - `search_key` is the indexed search key in _`search.txt`_.
  - `frequency` is the frequency data for the term's expression in the form of
    an usage count. A frequency of zero means the absence of data.

- __`dictionary_data.txt`__ - contains definition data for each entry in the
  dictionary. Each line in this corresponds with _`dictionary_main.txt`_ and
  consists of a JSON list with definitions where each entry is an object with
  the following fields:
  - `text` - list of one-based indexes into _`glossary.txt` for the term
    english definition lines.
  - `source` - one based index into _`sources.txt`_ for the term source
    dictionary.
  - `score` - score value for this entry, higher values have precedence.
  - `tags_term` - tags for the main Japanese term, indexing into _`tags.json`_.
  - `tags_text` - tags for the english definition, indexing into _`tags.json`_.
  - `rules` - tags relating to the grammatical function of the term. This also
    indexes into _`tags.json`_.

## Index files

Main index files reference entries in the dictionary using one-based indexing.

Reverse index files contain a single index that references the main index
entry, also using one-based indexing. Those files are generated by taking the
main index terms and sorting them by the reversed term string (character wise).
The purpose of reverse index files is to allow quick suffix search.

- __`english.txt`__ - contains an english reverse lookup index by word. Each
  line is a CSV where the first field in the english term and the remaining
  fields are the dictionary indexes containing that term.

  This index is generated from the glossary text by splitting it into words
  (using Unicode's `Alphabetic` property), filtering out Japanese words, and
  converting Unicode chars into the `a-z` ASCII range.

- __`terms_index.txt`__ - contains the CSV indexes of all dictionary terms
  related to the respective entry in _`terms.txt`_.

- __`search_index.txt`__ - contains the CSV indexes of all dictionary search
  keys related to the respective entry in _`search.txt`_.

- __`chars_index.txt`__ - contains the character lookup index. First field is
  the character, followed by the set size, followed by a list of dictionary
  entry indexes. Indexes can be individual numbers or inclusive ranges `A-B`.
